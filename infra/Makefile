# Daily Checkin CDK Infrastructure Makefile

.PHONY: help install localstack-start localstack-stop deploy-local deploy-dev test clean

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
help:
	@echo "Daily Checkin CDK Infrastructure"
	@echo ""
	@echo "Available commands:"
	@echo "  install         - Install dependencies"
	@echo "  localstack-start - Start LocalStack for local development"
	@echo "  localstack-stop  - Stop LocalStack"
	@echo "  deploy-local    - Deploy to LocalStack"
	@echo "  deploy-dev      - Deploy to AWS dev environment"
	@echo "  test           - Run tests"
	@echo "  clean          - Clean up generated files"

# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
install:
	@echo "ğŸ“¦ Installing dependencies..."
	pip install -e ".[dev,local]"

# LocalStackç’°å¢ƒ
localstack-start:
	@echo "ğŸš€ Starting LocalStack..."
	./scripts/localstack-start.sh

localstack-stop:
	@echo "ğŸ›‘ Stopping LocalStack..."
	./scripts/localstack-stop.sh

# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
deploy-local:
	@echo "ğŸš€ Deploying to LocalStack..."
	cdk deploy --context environment=local --require-approval never

deploy-dev:
	@echo "ğŸš€ Deploying to AWS dev environment..."
	cdk deploy --context environment=dev --require-approval never

# ãƒ†ã‚¹ãƒˆ
test:
	@echo "ğŸ§ª Running tests..."
	pytest tests/ -v

test-local:
	@echo "ğŸ§ª Running tests against LocalStack..."
	pytest tests/ -v --environment=local

# ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
clean:
	@echo "ğŸ§¹ Cleaning up..."
	rm -rf cdk.out/
	rm -rf .pytest_cache/
	rm -rf __pycache__/
	rm -rf **/__pycache__/

# é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆåˆå›ã®ã¿ï¼‰
setup-dev: install localstack-start
	@echo "âœ… Development environment setup complete!"
	@echo "   Run 'make deploy-local' to deploy to LocalStack"